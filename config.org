#+title: Config
#+PROPERTY: header-args :tangle config.el

ç°åœ¨æˆ‘ç”¨çš„ä¸»é¢˜æ˜¯â€¦â€¦

#+begin_src emacs-lisp
(setq doom-theme 'ef-spring)
#+end_src

* å¯åŠ¨
ä»Šæ—¥æ–¹çŸ¥æˆ‘æ˜¯æˆ‘ï¼š

#+begin_src emacs-lisp
(setq user-full-name "SouthFox"
      user-mail-address "master@southfox.me")
#+end_src

** æ¨ªå¹…
æ›¿æ¢ =Doom Emacs= çš„æ¨ªå¹…ï¼Œç”¨ä¸€åªç‹ç‹¸ï¼

#+begin_src emacs-lisp
(defun doom-dashboard-draw-ascii-emacs-banner-fn ()
  (let* ((banner
          '("                                                                   ,           "
            "                                                             _.-=;~ /_         "
            "                                                          _-~   '     ;.       "
            "                                                      _.-~     '   .-~-~`-._   "
            "                                                _.--~~:.             --.____88 "
            "                              ____.........--~~~. .' .  .        _..-------~~  "
            "                     _..--~~~~               .' .'             ,'              "
            "                 _.-~                        .       .     ` ,'                "
            "               .'                                    :.    ./                  "
            "             .:     ,/          `                   ::.   ,'                   "
            "           .:'     ,(            ;.                ::. ,-'                     "
            "          .'     ./'.`.     . . /:::._______.... _/:.o/                        "
            "         /     ./'. . .)  . _.,'               `88;?88|                        "
            "       ,'  . .,/'._,-~ /_.o8P'                  88P ?8b                        "
            "    _,'' . .,/',-~    d888P'                    88'  88|                       "
            " _.'~  . .,:oP'        ?88b              _..--- 88.--'8b.--..__                "
            ":     ...' 88o __,------.88o ...__..._.=~- .    `~~   `~~      ~-._ Fox! _.    "
            "`.;;;:='    ~~            ~~~                ~-    -       -   -               "))
         (longest-line (apply #'max (mapcar #'length banner))))
    (put-text-property
     (point)
     (dolist (line banner (point))
       (insert (+doom-dashboard--center
                +doom-dashboard--width
                (concat
                 line (make-string (max 0 (- longest-line (length line)))
                                   32)))
               "\n"))
     'face 'doom-dashboard-banner)))

;(unless (display-graphic-p) ; for some reason this messes up the graphical splash screen atm
  (setq +doom-dashboard-ascii-banner-fn #'doom-dashboard-draw-ascii-emacs-banner-fn) ;)
#+end_src

* org-mode
å°† =org-log-into-drawer= è®¾ä¸º =t= åï¼Œå®Œæˆä»»åŠ¡åçš„æ—¶é—´æˆ³å°†ä¼šæ”¶èµ·ï¼Œ
è¿™æ ·ä¸€äº›æ¯å¤©å®Œæˆçš„ä»»åŠ¡å°±ä¸ä¼šè¢«ç›¸å…³æ—¶é—´æˆ³å æ»¡ã€‚

#+begin_src emacs-lisp
(after! org
  (setq org-directory "~/org/"
        org-image-actual-width '(400)
        org-link-search-must-match-exact-headline nil
        org-log-done 'time
        org-log-into-drawer t))

#+end_src

** org-capture
ä¸€äº›æ•è·æ¨¡æ¿å’Œè·¯å¾„è®¾ç½®ï¼Œä½†è¯´å®åœ¨è‡ªä»ç”¨äº† =org-roam= é‚£è¾¹è¿™è¾¹å°±æ²¡æ€ä¹ˆç®¡äº†ã€‚

#+begin_src emacs-lisp
(setq org-agenda-files '("~/Sync/org/GTD/inbox.org"
                         "~/Sync/org/GTD/tickler.org"))

(after! org
  (setq org-capture-templates '(("t" "Todo [inbox]" entry
                               (file "~/Sync/org/GTD/inbox.org")
                               "* TODO %i%? \n SCHEDULED: %t")
                              ("T" "Tickler" entry
                               (file+headline "~/Sync/org/GTD/tickler.org" "Tickler")
                               "* %i%? \n %U"))))
#+end_src

** org-roam
ä¸»è¦æ˜¯ä¸€äº›æ•è·æ¨¡æ¿è®¾ç½®ï¼Œæ–‡ä»¶å‘½ååŠ ä¸Šæ—¶é—´è¿˜æ˜¯å› ä¸ºå¯¼å‡ºåˆ°æ•°å­—èŠ±å›­æ—¶ä¼šæ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹é‡Œï¼Œ
è€Œä¸ºäº†é¿å…é‡åã€‚

#+begin_src emacs-lisp
(setq org-roam-directory "~/Sync/org/Note/org-roam")
(setq org-roam-capture-templates
      '(("m" "main" plain
	 "%?"
	 :if-new (file+head "main/%<%Y%m%d%H%M%S>-${slug}.org"
			    "#+title: ${title}\n#+date: %T\n#+hugo_auto_set_lastmod: t\n#+hugo_section: main\n")
	 :immediate-finish t
	 :unnarrowed t)
	("r" "references" plain "%?"
	 :if-new
	 (file+head "references/%<%Y%m%d%H%M%S>-${title}.org" "#+title: ${title}\n#+date: %T\n#+hugo_auto_set_lastmod: t\n#+hugo_section: references\n")
	 :immediate-finish t
	 :unnarrowed t)
	("a" "article" plain "%?"
	 :if-new
	 (file+head "articles/%<%Y%m%d%H%M%S>-${title}.org" "#+title: ${title}\n#+date: %T\n#+filetags: :article:\n#+hugo_auto_set_lastmod: t\n#+hugo_section: articles\n")
	 :immediate-finish t
	 :unnarrowed t)))

(setq org-roam-dailies-capture-templates
      '(("d" "default" entry
         "* %?"
         :target (file+head "%<%Y-%m-%d>.org"
                            "#+title: %<%Y-%m-%d>\n#+date: %T\n#+hugo_auto_set_lastmod: t\n#+hugo_section: daily\n"))))

(with-eval-after-load 'ox-hugo
  (setq org-hugo-anchor-functions '(org-hugo-get-id
                                    org-hugo-get-heading-slug
                                    org-hugo-get-md5)))
#+end_src

*** Garden
æ•°å­—èŠ±å›­ï¼Œå¼€å§‹ç§æ¤æ€æƒ³â€¦â€¦

#+begin_src emacs-lisp
(defcustom org-roam-garden-file "~/Sync/org/GTD/garden.org"
  "The file used by roam garden."
  :group 'org-roam
  :type 'string)

(add-to-list 'org-agenda-files org-roam-garden-file)
#+end_src

#+begin_src emacs-lisp
(defun org-roam-garden-plant ()
  (interactive)
  (save-excursion
    (goto-char (point-min))
    (let* ((node (org-roam-node-at-point))
           (title (org-roam-node-title node))
           (file (org-roam-node-file node)))
      (org-set-property "GARDEN-STATE" "seedling")
      (org-roam-update-garden-file title file))
    (save-buffer)))

(defun org-roam-update-garden-file (heading file-path)
  (with-current-buffer (find-file-noselect org-roam-garden-file)
    (let ((buffer (current-buffer)))
      (if (org-find-exact-headline-in-buffer heading)
          (message "Plant exists, skip...")
        (goto-char (point-max))
        (insert (concat "* " heading "\n[[" file-path "]]"))
        (org-schedule nil (format "<%s 22:00 ++3d >" (format-time-string "%Y-%m-%d %u")))
        (save-buffer)))))

(defun my/org-roam-filter-by-properties (properties-name)
  (lambda (node)
    (assoc properties-name (org-roam-node-properties node))))

(defun my/org-roam-list-notes-by-properties (properties-name)
  (seq-filter
   (my/org-roam-filter-by-properties properties-name)
   (org-roam-node-list)))

(defun my/org-roam-garden-dashboard--build-item (node)
  (concat "\n** " (org-roam-node-title node) "\n[[" (org-roam-node-file node) "]]"))

(defun my/org-roam-garden-dashboard ()
  (interactive)
  (with-current-buffer (get-buffer-create "*Garden*")
    (erase-buffer)
    (let ((filtered-node (my/org-roam-list-notes-by-properties "GARDEN-STATE")))
      (insert "* ğŸŒ± seedling")
      (insert (string-join (mapcar #'my/org-roam-garden-dashboard--build-item
                                   filtered-node))))
    (org-mode)
    (switch-to-buffer (current-buffer))))
#+end_src

** org-roam-ui
éå¸¸é…·ç‚«çš„ä¸€ä¸ªç½‘é¡µ =roam= ç¬”è®°æŸ¥çœ‹ï¼Œå¯æƒœå¦‚æœèƒ½å¤ŸåªæŸ¥çœ‹æŸä¸ªèŠ‚ç‚¹å°±å¥½äº†ï¼Œ
æ•°æ®é‡ä¸€å¤§æˆ‘æ€•æ‰“å¼€ä¼šç›´æ¥å¡æ­»ã€‚

#+begin_src emacs-lisp
(use-package! websocket
    :after org-roam)

(use-package! org-roam-ui
    :after org-roam ;; or :after org
;         normally we'd recommend hooking orui after org-roam, but since org-roam does not have
;         a hookable mode anymore, you're advised to pick something yourself
;         if you don't care about startup time, use
;  :hook (after-init . org-roam-ui-mode)
    :config
    (setq org-roam-ui-sync-theme t
          org-roam-ui-follow t
          org-roam-ui-update-on-save t
          org-roam-ui-open-on-start t))
#+end_src

** org-fragtog
å¥½åƒæ˜¯ =latex= ç›¸å…³çš„é¢„è§ˆåŒ…â€¦â€¦ï¼Ÿ

#+begin_src emacs-lisp
(use-package! org-fragtog
  :hook (org-mode . org-fragtog-mode))
#+end_src

** roam-publish
ä¸€äº›ä»ä¸–ç•Œå„åœ°æ‹¼å‡ºæ¥çš„ä»£ç ï¼Œè¿˜æœ‰ä¸€äº›è‡ªå·±å•çº¯å †å è°ƒç”¨çš„å‡½æ•°ï¼Œ
æˆ‘çœŸè¯¥ç³»ç»Ÿå­¦å­¦ =elisp= +1 ã€‚

#+begin_src emacs-lisp
(setq org-hugo-base-dir "~/Documents/roam-publish/")

(defun my/org-roam-filter-by-tag (tag-name)
  (lambda (node)
    (member tag-name (org-roam-node-tags node))))

(defun my/org-roam-list-notes-by-tag (tag-name)
  (mapcar #'org-roam-node-file
          (seq-filter
           (my/org-roam-filter-by-tag tag-name)
           (org-roam-node-list))))

(defun my/org-roam-export-all ()
  "Re-exports all Org-roam files to Hugo markdown."
  (interactive)
  (dolist (org-file (my/org-roam-list-notes-by-tag "publish"))
  ;(dolist (org-file (directory-files-recursively org-roam-directory "\.org$"))
    (with-current-buffer (find-file org-file)
        (org-hugo-export-wim-to-md))))

(defun my/org-roam-publish ()
  "Publish current file"
  (interactive)
  (org-roam-update-org-id-locations)
  (org-roam-set-keyword "filetags" ":publish:")
  (save-buffer)
  (let ((publish-content (buffer-string)))
    (with-current-buffer (get-buffer-create "*Garden*")
      (erase-buffer)
      (insert publish-content)
      (org-mode)
      (org-roam-set-keyword "EXPORT_FILE_NAME" (cadar (org-collect-keywords '("title"))))
      (if-let ((headline (org-find-exact-headline-in-buffer "æ€»ç»“")))
          (progn
            (goto-char headline)
            (org-cut-subtree)))
      (org-hugo-export-wim-to-md)))

  (async-shell-command (concat
                        "cd " org-hugo-base-dir
                        " && " "git add ."
                        (if (yes-or-no-p "Push now?")
                            (concat " && " "git commit -m '[post] new post'"
                                    " && " "git push"))) "*Messages*")
  (message "publish nwe post!"))

(defun my/org-roam-creat-node ()
  "creat node and add IS_NODE property"
  (interactive)
  (org-id-get-create)
  (org-set-tags ":NODE:")
  (save-buffer)
  (org-hugo-export-wim-to-md))
#+end_src

** org-clip
#+begin_src emacs-lisp
(setq org-cliplink-transport-implementation 'curl)
(setq org-cliplink-curl-transport-arguments '("-L" "-x" "http://127.0.0.1:10809"))
#+end_src
* å®
** cond-let
ç»ˆäºçŸ¥é“ä¸ºä»€ä¹ˆæ²¡äººæƒ³å†™è¿™ä¸ªå®äº†ï¼Œæ‹¬å·æ˜¯çœŸå¾—å¤šå•Šã€‚

#+begin_src emacs-lisp
(defmacro cond-let (&rest forms)
  (declare (debug t))
  (if (not (equal forms 'nil))
      `(let* ,(setq varlist (internal--build-bindings (caar forms)))
         (if-let ,(car (last varlist))
             ,(cadar forms)
           (cond-let ,@(cdr forms))))))
#+end_src

* æ‚é¡¹
=cnfonts= æ˜¯ä¸€ä¸ªå¯ä»¥åˆ†åˆ«è®¾ç½®ä¸­è‹±æ–‡å­—ä½“çš„ bk ï¼Œæ–¹ä¾¿å¯¹å…¶è¡¨æ ¼ã€‚

=word-wrap-by-category= æ˜¯ä¸­æ–‡ä¼˜åŒ–ï¼Œå½“ä¸€è¡Œæœ‰è‹±æ–‡å’Œä¸­æ–‡æ—¶ä¸æŠ˜è¡Œã€‚

#+begin_src emacs-lisp
(setq cnfonts-personal-fontnames
      '(()
        ()
        ("Noto Color Emoji")
        ()
        ()))
(cnfonts-mode 1)

(setq word-wrap-by-category t)

(setq doom-unicode-font (font-spec :family "Noto Color Emoji"))
(add-to-list 'default-frame-alist '(height . 35))
(add-to-list 'default-frame-alist '(width . 102))
#+end_src

** å½©è™¹æ‹¬å·
#+begin_src emacs-lisp
(add-hook 'python-mode-hook  #'rainbow-delimiters-mode)
(add-hook 'clojure-mode-hook #'rainbow-delimiters-mode)
#+end_src

** Shell
å°†ä½¿ç”¨çš„ç»ˆç«¯åˆ‡æ¢åˆ° =zsh= ã€‚

#+begin_src emacs-lisp
(setq shell-file-name "/bin/zsh"
      vterm-max-scrollback 5000)
#+end_src

** TODO æ´¾å¯¹é¹¦é¹‰
å¿«æ·é”®å’Œè¯å…¸ï¼Œä½†è¯´å®åœ¨æ²¡ç”¨è¿‡è¿™åŠŸèƒ½ï¼Œæ¯•ç«Ÿè¿™ä¸ªåŒ…çš„é‡ç‚¹å½“ç„¶æ˜¯åœ¨åŠ¨å›¾ä¸Šã€‚

#+begin_src emacs-lisp
(parrot-mode 1)
(define-key evil-normal-state-map (kbd "[r") 'parrot-rotate-prev-word-at-point)
(define-key evil-normal-state-map (kbd "]r") 'parrot-rotate-next-word-at-point)

(setq parrot-rotate-dict
      '(
        (:rot ("yes" "no") :caps t :upcase t)
        (:rot ("&" "|"))
        (:rot ("begin" "end") :caps t :upcase t)
        (:rot ("enable" "disable") :caps t :upcase t)
        (:rot ("enter" "exit") :caps t :upcase t)
        (:rot ("forward" "backward") :caps t :upcase t)
        (:rot ("front" "rear" "back") :caps t :upcase t)
        (:rot ("get" "set") :caps t :upcase t)
        (:rot ("high" "low") :caps t :upcase t)
        (:rot ("in" "out") :caps t :upcase t)
        (:rot ("left" "right") :caps t :upcase t)
        (:rot ("min" "max") :caps t :upcase t)
        (:rot ("on" "off") :caps t :upcase t)
        (:rot ("start" "stop") :caps t :upcase t)
        (:rot ("true" "false") :caps t :upcase t)
        (:rot ("&&" "||"))
        (:rot ("==" "!="))
        (:rot ("if" "else" "elif"))
        (:rot ("ifdef" "ifndef"))
        ))

#+end_src

å®šä¹‰ä¸€ä¸ªå¯ä»¥é’©ä½å¤šä¸ª =hook= çš„å‡½æ•°ï¼Œæˆ‘æ„Ÿè§‰æˆ‘ä¸å­¦ =elisp= çš„è¯çœŸä¸è¡Œäº†å•Šâ€¦â€¦

#+begin_src emacs-lisp
(defun my-add-to-multiple-hooks (function hooks)
  (mapc (lambda (hook)
          (add-hook hook function))
        hooks))
#+end_src

ä¹‹åå°†åœ¨å®Œæˆä¸€ä¸ªç•ªèŒ„é’Ÿæ’­æ”¾ç‚¹èµåŠ¨ç”»ï¼Œä¿å­˜ä¸€ä¸ªæ–‡ä»¶æ—¶æ’­æ”¾ =emacs= åŠ¨ç”»ç­‰ç­‰ï¼Œ
æ„Ÿè§‰çœŸè¯¥å­¦å­¦ =elisp= äº†å•Šï¼Œå¿…é¡»å¾—é‡æ„è¿™æ®µäº†ã€‚

#+begin_src emacs-lisp
(defun my-parrot-thumbsup-play ()
  (parrot-set-parrot-type 'thumbsup)
  (parrot-start-animation))

(defun my-parrot-emacs-play ()
  (parrot-set-parrot-type 'emacs)
  (parrot-start-animation))

(defun my-parrot-rotating-play ()
  (parrot-set-parrot-type 'rotating)
  (parrot-start-animation))

(my-add-to-multiple-hooks
 'my-parrot-thumbsup-play
 '(org-after-todo-state-change-hook
   org-clock-in-hook
   org-timer-done-hook
   git-commit-post-finish-hook))

(my-add-to-multiple-hooks
 'my-parrot-emacs-play
 '(after-save-hook
   find-file-hook))
#+end_src

** å…¶å®ƒæ–‡ä»¶
å­˜æ”¾ä¸€äº› =token= çš„ç§˜å¯†æ–‡ä»¶ï¼Œåº”è¯¥æ³¨æ„ä¸èƒ½éš =git= ä¸Šä¼ æˆ–è€…åŒæ­¥ã€‚

#+begin_src emacs-lisp
(load! "secrets")
(load! "elisp/hy")
(load! "elisp/aaii")
(setq-default custom-file (expand-file-name "secrets.el" doom-user-dir))
(when (file-exists-p custom-file)
  (load custom-file))
#+end_src

* æ–‡çŒ®ç®¡ç†
** Citar
#+begin_src emacs-lisp
(setq bibtex-completion-pdf-field "File")
(setq bibtex-completion-bibliography '("~/Sync/Ebook/catalog.bib"))
(setq citar-bibliography '("~/Sync/Ebook/catalog.bib"))
#+end_src

* å·¥å…·
** SDCV
ç¿»è¯‘åŒ…ï¼Œè¯å…¸è¦è‡ªå·±ä¸‹ï¼ŒåŒæ—¶ä¸è¦å¿˜äº†å®‰è£… =stardict= å’Œ =sdcv= è¿™ä¸¤ä¸ªè½¯ä»¶ã€‚

#+begin_src emacs-lisp
(setq sdcv-say-word-p t)
(setq sdcv-dictionary-data-dir (expand-file-name "~/.stardict/dic/"))

(map! :leader :desc "sdvc" "z" #'sdcv-search-pointer+)
#+end_src

** Mastodon
ä½¿ç”¨ [[https://codeberg.org/martianh/mastodon.el][mastodon.el]] åœ¨æ— æ‰€äº‹äº‹æ—¶å¿«é€Ÿæ‰“å¼€ =Mastodon= è¿›è¡Œä¸€ä¸ªé±¼çš„æ‘¸ï¼

#+begin_src emacs-lisp :tangle no
(setq mastodon-instance-url "https://social.instance.org"
      mastodon-active-user "example_user")
#+end_src

ç„¶åè®¾ç½®æŒ‰é”®ç»‘å®šï¼Œç°åœ¨çš„è®¾ç½®è¿˜æœ‰ä¸€äº›é—®é¢˜ï¼Œä¸»è¦æ˜¯è¦åœ¨ä¸å¹²æ‰° =evil= å¿«æ·é”®çš„
æƒ…å†µä¸‹å¡å…¥æ–°çš„æŒ‰é”®è¿˜æ˜¯æŒºéš¾çš„ã€‚

#+begin_src emacs-lisp
(map! :leader
      :prefix ("o")
      :desc "Mastodon"          "M" #'mastodon)

(map! :after mastodon
      :map mastodon-mode-map
      :n "[ [" #'mastodon-tl--goto-prev-toot
      :n "] ]" #'mastodon-tl--goto-next-toot
      :n "g k" #'mastodon-tl--previous-tab-item
      :n "g j" #'mastodon-tl--next-tab-item

      :n "q" #'kill-current-buffer
      :n "Q" #'kill-buffer-and-window

      ;;; timelines
      :n "#" #'mastodon-tl--get-tag-timeline
      :n "A" #'mastodon-profile--get-toot-author
      :n "F" #'mastodon-tl--get-federated-timeline
      :n "H" #'mastodon-tl--get-home-timeline
      :n "L" #'mastodon-tl--get-local-timeline
      :n "N" #'mastodon-notifications-get
      :n "O" #'mastodon-profile--my-profile
      :n "P" #'mastodon-profile--show-user
      :n "T" #'mastodon-tl--thread

      ;;; toot actions
      :n "K" #'mastodon-toot--bookmark-toot-toggle
      :n "R" #'mastodon-toot--toggle-boost
      :n "c" #'mastodon-tl--toggle-spoiler-text-in-toot
      :n "C" #'mastodon-toot--copy-toot-url
      :n "o" #'mastodon-url-lookup
      :n "d" #'mastodon-toot--delete-toot
      :n "D" #'mastodon-toot--delete-draft-toot
      :n "f" #'mastodon-toot--toggle-favourite
      :n "r" #'mastodon-toot--reply
      :n "u" #'mastodon-tl--update
      :n "v" #'mastodon-tl--poll-vote

      ;;; toot!
      :n "t" #'mastodon-toot

      ;;; mastodon additions
      :n "S"    #'mastodon-search--search-query
      :n "V F"  #'mastodon-profile--view-favourites
      :n "V B"  #'mastodon-profile--view-bookmarks
      :n "V L" #'mastodon-tl--view-list-timeline
      )
#+end_src

** Debuger
è¯´æ¥æƒ­æ„§ï¼Œå…¶å®æ²¡æ€ä¹ˆç”¨è¿‡ï¼Œ
æˆ–è€…è¯´è¿˜éœ€è¦è°ƒä¼˜æ‰èƒ½è¿½ä¸Š =VS code= çš„ä½¿ç”¨ä½“éªŒã€‚

#+begin_src emacs-lisp
(after! dap-mode
  (setq dap-python-debugger 'debugpy))

(map! :map dap-mode-map
      :leader
      :prefix ("d" . "dap")
      ;;; basics
      :desc "dap next"          "n" #'dap-next
      :desc "dap step in"       "i" #'dap-step-in
      :desc "dap step out"      "o" #'dap-step-out
      :desc "dap continue"      "c" #'dap-continue
      :desc "dap hydra"         "h" #'dap-hydra
      :desc "dap debug restart" "r" #'dap-debug-restart
      :desc "dap debug"         "s" #'dap-debug

      ;;; debug
      :prefix ("dd" . "Debug")
      :desc "dap debug recent"  "r" #'dap-debug-recent
      :desc "dap debug last"    "l" #'dap-debug-last

      ;;; eval
      :prefix ("de" . "Eval")
      :desc "eval"                "e" #'dap-eval
      :desc "eval region"         "r" #'dap-eval-region
      :desc "eval thing at point" "s" #'dap-eval-thing-at-point
      :desc "add expression"      "a" #'dap-ui-expressions-add
      :desc "remove expression"   "d" #'dap-ui-expressions-remove

      :prefix ("db" . "Breakpoint")
      :desc "dap breakpoint toggle"      "b" #'dap-breakpoint-toggle
      :desc "dap breakpoint condition"   "c" #'dap-breakpoint-condition
      :desc "dap breakpoint hit count"   "h" #'dap-breakpoint-hit-condition
      :desc "dap breakpoint log message" "l" #'dap-breakpoint-log-message)

#+end_src

** TODO Rime
ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ä¹Ÿå¯ä»¥å†…ç½®è¾“å…¥æ³•å‘¢â€¦â€¦

#+begin_src emacs-lisp
(use-package! rime
  :custom
  (default-input-method "rime")
  :config
  (define-key rime-mode-map (kbd "C-i") 'rime-force-enable)
  (setq rime-show-candidate 'popup)
  (setq rime-disable-predicates
        '(rime-predicate-evil-mode-p
          rime-predicate-after-alphabet-char-p
          rime-predicate-space-after-cc-p
          rime-predicate-current-uppercase-letter-p
          rime-predicate-punctuation-line-begin-p)))
#+end_src

- [ ] ä¼˜åŒ–ä¸­è‹±æ–‡åˆ‡æ¢æ–­è¨€
- [ ] å¦‚ä½•åœ¨ä¸€äº›è¾“å…¥ä¸­è‡ªåŠ¨åˆ‡æ¢åˆ°ä¸­æ–‡ï¼Ÿä¾‹å¦‚ =org-roam=
- [ ] æ”¹é”®ï¼Œç°åœ¨çš„ =C \= ç¡®å®æœ‰ç‚¹æŠ˜ç£¨
** åŠ›æ‰£
ä¸€äº›è¯­è¨€éœ€è¦ä¿å­˜æ–‡ä»¶æ‰æœ‰ =lsp= æ”¯æŒâ€¦â€¦æˆ‘çœŸå¾—éœ€è¦ =lsp=

#+begin_src emacs-lisp
(setq leetcode-prefer-language "racket")
(setq leetcode-save-solutions t)
(setq leetcode-directory "~/Documents/leetcode")
#+end_src

* ä¿¡æ¯
æ›´å¤šä¿¡æ¯è¯·å‚è€ƒä¸‹é¢è¿™ç¯‡æ–‡ç« ï¼š
[[https://liujiacai.net/blog/2021/03/05/emacs-love-mail-feed/][ä½¿ç”¨ Emacs é˜…è¯»é‚®ä»¶ä¸ RSS - Keep Coding]]
** é‚®ä»¶
#+begin_src emacs-lisp
(add-to-list 'load-path (expand-file-name "/home/southfox/.guix-home/profile/share/emacs/site-lisp/mu4e"))
(after! mu4e
  (setq mu4e-get-mail-command "true")
  (setq mu4e-update-interval (* 21 60)))

(set-email-account! "southfox.me"
  '((mu4e-sent-folder       . "/Sent")
    (mu4e-drafts-folder     . "/southfox.me/Drafts")
    (mu4e-trash-folder      . "/southfox.me/Trash")
    (mu4e-refile-folder     . "/southfox.me/All Mail")
    (smtpmail-smtp-user     . "master@southfox.me")
    (mu4e-compose-signature . "---\nFor mu4e"))
  t)
#+end_src

* Clojure
#+begin_src emacs-lisp
(use-package! flycheck-clj-kondo
  :after (clojure-mode))

(use-package! clj-refactor
  :after (clojure-mode))
#+end_src

* Python
è‡ªåŠ¨åˆ‡æ¢è™šæ‹Ÿç¯å¢ƒï¼Œ poetry åŒ…å¯èƒ½åœ¨å¤„ç†è¿œç«¯æœºå™¨çš„é¡¹ç›®å¯èƒ½ä¼šæœ‰é—®é¢˜æ‰€ä»¥ä»é‚£è¾¹æŠ å‡ºæ¥æ”¾åˆ°è¿™é‡Œã€‚

#+begin_src emacs-lisp
(defvar poetry-venv-list '()
  "List of known poetry virtualenvs.")

(defun my/track-python-virtualenv (&optional _)
  (interactive)
  (when (and buffer-file-name
             (string= nil (file-remote-p default-directory)))
    (cond-let (((current-project (locate-dominating-file default-directory "pyproject.toml")))
               (if-let ((poetry-current-project-venv (cdr (assq 'current-project poetry-venv-list))))
                   (unless (equal python-shell-virtualenv-path poetry-current-project-venv)
                     (pyvenv-activate poetry-current-project-venv))
                 (let ((poetry-project-path (locate-dominating-file default-directory "pyproject.toml"))
                       (poetry-venv-path (s-trim (shell-command-to-string "env -u VIRTUAL_ENV poetry env info -p"))))
                   (pyvenv-activate poetry-venv-path)
                   (add-to-list 'poetry-venv-list (cons poetry-project-path poetry-venv-path)))))
              (((current-project (locate-dominating-file default-directory ".venv")))
               (pyvenv-activate (concat current-project ".venv")))
              (((current-project (locate-dominating-file default-directory "venv")))
               (pyvenv-activate (concat current-project "venv")))
              (((default t)) (pyvenv-deactivate)))))

(add-to-list 'window-buffer-change-functions 'my/track-python-virtualenv)
#+end_src

åŒæ—¶å¯ç”¨ pylint å’Œ pyright-lsp ã€‚

#+begin_src emacs-lisp
(defvar-local my/flycheck-local-cache nil)

(defun my/flycheck-checker-get (fn checker property)
  (or (alist-get property (alist-get checker my/flycheck-local-cache))
      (funcall fn checker property)))

(advice-add 'flycheck-checker-get :around 'my/flycheck-checker-get)

(add-hook 'lsp-managed-mode-hook
          (lambda ()
            (when (and (string= nil (file-remote-p default-directory))
                       (derived-mode-p 'python-mode))
              (setq my/flycheck-local-cache '((lsp . ((next-checkers . (python-pylint)))))))))

#+end_src
